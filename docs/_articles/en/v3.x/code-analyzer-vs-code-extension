# Salesforce Code Analyzer Visual Studio Code Extension (Beta)

The Salesforce Code Analyzer Visual Studio (VS) Code Extension (beta) is an extension that integrates many of Code Analyzer's most useful features into VS Code, allowing them to be easily run with clicks instead of terminal commands.

Note: If you’re listing a managed package on AppExchange, it must pass security review. You’re also required to upload your Salesforce Code Analyzer scan reports. Run Code Analyzer via the VS Code extension and update your code. Next, to produce the required scan reports for your AppExchange listing, you must run Code Analyzer via the command line either within VS Code or as standalone. Attach your scan reports to your submission in the AppExchange Security Review Wizard. Read Scan Your Solution with Salesforce Code Analyzer for details.
Using the Code Analyzer VS Code Extension
Use the Code Analyzer VS Code extension to scan multiple languages:

* PMD rule engine
* RetireJS
* Salesforce Graph Engine (Generally Available rules only)

## Set Up

* Install Salesforce CLI
* In your terminal, run sfdx plugins:install @salesforce/sfdx-scanner
* Install the (Salesforce Code Analyzer (beta) VS Code extension)[installation link]

## Launch Code Analyzer and Scan Your Code

Follow this recommended process:

1. Open your project in VS Code.
2. Scan your code with Code Analyzer.
3. Update your code based on the findings.
4. Rescan your code. 
5. Scan individual methods within your code with Code Analyzer’s Graph Engine path-based analysis. 
6. Rescan your code with Graph Engine.
7. If you’re listing a managed package on AppExchange, follow the instructions in (Scan Your Solution with Code Analyzer)[https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_code_analyzer_scan.htm] to produce the required scan reports.

### Code Analyzer Scans

Complete one of these options to perform a Code Analyzer scan.

* To scan selected files or folders:

1. Select a group of files or folders.
2. Right click in the VS Code explorer and select *SFDX: Scan selected files or folders with Code Analyzer*.

* To scan a single code file:

1. Open a code file in the Editor.
2. From the VS Code command palette, choose *SFDX: Scan current file with Code Analyzer*.
3. Alternatively, right click in the editor and select *SFDX: Scan current file with Code Analyzer*.

Regardless of which option you chose, the progress bar notifies you that the scan of your current file is active.

After your scan is complete, note how many files were scanned and how many violations were produced.

![The VS Code progress bar displaying a Scanned 1 files, 7 violations found in 1 files completion message.](/assets/images/vscode-images/CodeAnalyzerViolationsProgressBar.png)

#### Act Upon Your Code Analyzer Results and Rescan Your Code

When your scan is complete, you see a scrollable list of violations that Code Analyzer found.

![alt text: Sample VS Code code and Salesforce Code Analyzer scan results](/assets/images/vscode-images/CodeAnalyzerViolationImage.png)

Each violation message reveals the violation severity and details about the violation found in this pattern: `SevX: [Violation message]`

*Example:*

```Sev3. Validate CRUD permission before SOQL/DML operation or enforce user mode. (PMD via Code Analyzer)```

To address the violations found and to rescan your code, follow these steps:

1. Scroll through the results that Code Analyzer found.
2. Update your code directly in VS Code.
3. When your edits are complete, rescan your code using your preferred method.

#### Produce Code Analyzer Reports for AppExchange Security Review

If you’re an AppExchange partner submitting your managed package for security review, you must scan it with Salesforce Code Analyzer and provide test results in your solution’s AppExchange Security Review submission. Follow the instructions in (Scan Your Solution with Salesforce Code Analyzer)[https://developer.salesforce.com/docs/atlas.en-us.244.0.packagingGuide.meta/packagingGuide/security_review_code_analyzer_scan.htm] to produce the required reports.

#### Use a Quick Fix to Suppress a Code Analyzer PMD Violation

After you scan your code with Code Analyzer, there can be situations where you want to suppress a PMD violation that was identified. 

To use a quick fix to suppress a PMD violation on a line of code, follow these steps:

1. Mouse over the identified problem.
2. Click **Quick Fix** in the pop-up.
3. Click **Suppress violations on this line**.

#### Replace Code Analyzer’s PMD Config File with a Custom PMD Config

By default, Code Analyzer runs all of PMD's default rules against your Apex and VisualForce files. However, you may have a custom PMD configuration that better suits your specific needs, and wish to substitute your configuration in place of ours.

[alt text: Salesforce Code Analyzer Settings with Code Analyzer > PMD Custom Config File section and a sample file location]

To use your own custom PMD ruleset in Code Analyzer, follow these instructions:

1. In VS Code, go to Preferences > Settings.
2. Click the **User** or **Workspace** tab.

	* Choose User to override the configuration on the current project.
	* Choose Workspace to override the configuration in all projects.

3. Expand the Extensions section and scroll to Salesforce Code Analyzer.
4. In Code Analyzer > PMD > Custom Config File, enter the absolute path to your custom PMD configuration.

	*Example*: /Users/MyUsername/Code/sfdx-scanner/

### Salesforce Graph Engine

To perform a Graph Engine path-based analysis on a single method follow these instructions:

1. Open a file in the VS Code editor.
2. Right-click on the method you want to scan.
3. Select **SFDX: Scan selected method with Graph Engine path-based analysis**.

The progress bar notifies you that the scan of your current file is active.

After your scan is complete, a new tab opens with the files that were scanned and how many violations were produced.

#### Act Upon Your Graph Engine Results and Rescan Your Code

When your scan is complete, a new tab opens with an html display of the violations found.

Each violation message reveals the violation severity and details about the violation found in this pattern: SevX: [Violation message]

*Example*: 

```Sev3. Validate CRUD permission before SOQL/DML operation or enforce user mode. (PMD via Code Analyzer)```

To address the violations found and to rescan your code, follow these steps:

1. On the VS Code tab with your Graph Engine results, review the violations that Graph Engine found.
2. On the VS Code tab with your code file open, update your code.

When your edits are complete, rescan your code.
